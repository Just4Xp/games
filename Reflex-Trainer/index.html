<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Reflex Trainer</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:'Segoe UI',sans-serif;}
body{background:#0d0f1d;color:#fff;height:100vh;display:flex;justify-content:center;align-items:center;}
.screen{display:flex;width:95%;height:95%;border-radius:12px;overflow:hidden;background:#111227;}
.hidden{display:none;transition:0.3s;}
#menu{flex-direction:row;}
#menu-left{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;padding:20px;gap:16px;}
#menu-left h1{font-size:2.2rem;background:linear-gradient(90deg,#00f2fe,#4facfe);-webkit-background-clip:text;color:transparent;}
.level-btn{width:90%;padding:14px;margin:6px 0;border:none;border-radius:12px;background:linear-gradient(135deg,#4facfe,#00f2fe);color:#fff;font-weight:bold;cursor:pointer;transition:0.3s;box-shadow:0 0 10px rgba(0,255,255,0.3);}
.level-btn:hover{transform:translateY(-5px);box-shadow:0 0 20px rgba(0,255,255,0.6);}
#start-btn{margin-top:20px;padding:14px;width:60%;border:none;border-radius:12px;background:linear-gradient(135deg,#ff6b6b,#ff5252);font-weight:bold;cursor:pointer;color:#fff;box-shadow:0 0 10px rgba(255,107,107,0.4);transition:0.3s;}
#start-btn:hover{transform:scale(1.05);box-shadow:0 0 20px rgba(255,107,107,0.6);}
#menu-right{flex:1;background:rgba(30,34,55,0.95);padding:20px;display:flex;flex-direction:column;gap:12px;overflow-y:auto;border-left:2px solid #333;border-radius:0 12px 12px 0;}
#menu-right h2{margin-bottom:6px;font-size:1.4rem;}
.info-section{margin-bottom:12px;background:rgba(255,255,255,0.05);padding:10px;border-radius:8px;box-shadow:0 0 10px rgba(0,255,255,0.2);}
.info-section h3{margin-bottom:4px;font-size:16px;}
.info-section ul{list-style:disc;margin-left:20px;font-size:14px;}
#game{flex-direction:row;position:relative;}
#playArea{flex:2;position:relative;background:linear-gradient(145deg,#101227,#161a3d);}
.target{position:absolute;border-radius:50%;background:radial-gradient(circle,#ff6b6b,#b30000);cursor:pointer;animation:pop .15s ease-out;}
@keyframes pop{from{transform:scale(0)}to{transform:scale(1)}}
.burst{position:absolute;border-radius:50%;pointer-events:none;background:radial-gradient(circle,#fff,#ff6b6b,transparent);}
#panel{flex:1;padding:14px;display:flex;flex-direction:column;gap:8px;background:rgba(30,34,55,0.95);overflow-y:auto;border-left:2px solid #333;border-radius:0 12px 12px 0;}
.stat{font-size:14px;}
canvas{background:#101227;border-radius:6px;cursor:pointer;}
button{padding:10px;margin-top:4px;background:linear-gradient(135deg,#4facfe,#00f2fe);color:#fff;font-weight:bold;border-radius:6px;cursor:pointer;box-shadow:0 0 10px rgba(0,255,255,0.3);transition:0.3s;}
button:active{transform:scale(.97);}
#begin-btn{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);padding:20px 40px;font-size:1.5rem;z-index:10;display:none;border-radius:12px;background:linear-gradient(135deg,#ff6b6b,#ff5252);}
@media(max-width:800px){#menu,#game{flex-direction:column;}#menu-right,#panel{width:100%;height:35%;border-left:none;border-top:2px solid #333;}}
</style>
</head>
<body>

<!-- MENU -->
<div id="menu" class="screen">
  <div id="menu-left">
    <h1>Reflex Trainer</h1>
    <div id="levels-container"></div>
    <button id="start-btn">Start Game</button>
  </div>
  <div id="menu-right">
    <h2>Level Details</h2>
    <div class="info-section" id="level-info"></div>
    <div class="info-section">
      <h3>Graph Info</h3>
      <p>X-axis = hit order, Y-axis = reaction time (ms). Click dots to see reflex for that hit.</p>
    </div>
    <div class="info-section">
      <h3>Reflex Tiers</h3>
      <ul>
        <li>0–4ms = Computer</li>
        <li>5–19ms = Cheetah</li>
        <li>20–70ms = Cat</li>
        <li>71–74ms = Bird</li>
        <li>75–80 = Snake</li>
        <li>81–150 = Human</li>
        <li>151–300 = Tortoise</li>
        <li>301–500 = Sloth</li>
        <li>501–1000 = Blue Whale</li>
        <li>&gt;1000 = Knucklehead</li>
      </ul>
    </div>
  </div>
</div>

<!-- GAME -->
<div id="game" class="screen hidden">
  <div id="playArea"></div>
  <button id="begin-btn">Begin</button>
  <div id="panel">
    <h2>Live Stats</h2>
    <div class="stat" id="levelTxt"></div>
    <div class="stat" id="leftTxt"></div>
    <div class="stat" id="lastTxt"></div>
    <div class="stat" id="avgTxt"></div>
    <div class="stat" id="bestTxt"></div>
    <div class="stat" id="tierTxt"></div>
    <canvas id="graph" width="300" height="160"></canvas>
    <button onclick="restart()">Restart</button>
    <button onclick="quit()">Quit</button>
  </div>
</div>

<script>
const levels={
 Easy:{targets:10,size:60,duration:2000,desc:"Big targets, slow speed"},
 Normal:{targets:15,size:55,duration:1600,desc:"Moderate size and speed"},
 Hard:{targets:20,size:48,duration:1200,desc:"Smaller targets, faster"},
 Extreme:{targets:25,size:42,duration:900,desc:"Very small and fast"},
 Impossible:{targets:30,size:36,duration:700,desc:"Tiny targets, very fast"},
 Hacker:{targets:35,size:30,duration:500,desc:"Ultra tiny targets, ultra fast"}
};
let levelName="Normal";
const levelsContainer=document.getElementById("levels-container");
const levelInfo=document.getElementById("level-info");

function createMenuButtons(){
  for(let lvl in levels){
    const btn=document.createElement("button");
    btn.className="level-btn";
    btn.textContent=lvl;
    btn.onclick=()=>{levelName=lvl;updateLevelInfo();}
    levelsContainer.appendChild(btn);
  }
}
function updateLevelInfo(){
  const cfg=levels[levelName];
  const best=localStorage.getItem("best_"+levelName);
  levelInfo.innerHTML=`<h3>${levelName}</h3>
  <ul>
    <li>Targets: ${cfg.targets}</li>
    <li>Target Size: ${cfg.size}</li>
    <li>Target Duration: ${cfg.duration} ms</li>
    <li>Difficulty: ${cfg.desc}</li>
    <li>Best Avg Reflex: ${best?best+" ms":"None"}</li>
  </ul>`;
}
createMenuButtons();
updateLevelInfo();

let remaining, reflex=[], currentSpawn, activeTimeout=null;
const playArea=document.getElementById("playArea");
const graph=document.getElementById("graph");
const ctx=graph.getContext("2d");
const beginBtn=document.getElementById("begin-btn");

function reflexType(ms){
 if(ms<=4)return"Computer";
 if(ms<=19)return"Cheetah";
 if(ms<=70)return"Cat";
 if(ms<=74)return"Bird";
 if(ms<=80)return"Snake";
 if(ms<=150)return"Human";
 if(ms<=300)return"Tortoise";
 if(ms<=500)return"Sloth";
 if(ms<=1000)return"Blue Whale";
 return"Knucklehead";
}

function playHitSound() {
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const oscillator = audioCtx.createOscillator();
    const gainNode = audioCtx.createGain();
    oscillator.type = 'square';
    oscillator.frequency.setValueAtTime(800, audioCtx.currentTime);
    gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime);
    oscillator.connect(gainNode);
    gainNode.connect(audioCtx.destination);
    oscillator.start();
    oscillator.stop(audioCtx.currentTime + 0.1);
}

function spawn(){
 if(remaining<=0){ saveBestReflex(); return; }
 const cfg=levels[levelName];
 const t=document.createElement("div");
 t.className="target"; t.style.width=t.style.height=cfg.size+"px";
 t.style.left=Math.random()*(playArea.clientWidth-cfg.size)+"px";
 t.style.top=Math.random()*(playArea.clientHeight-cfg.size)+"px";
 playArea.appendChild(t);
 currentSpawn = performance.now();

 activeTimeout = setTimeout(()=>{
   t.remove();
   remaining--; updateStats();
   spawn();
 }, cfg.duration);

 t.onclick = e => {
   clearTimeout(activeTimeout);
   const r = performance.now() - currentSpawn;
   reflex.push(r);
   burst(e.clientX,e.clientY);
   playHitSound();
   t.remove();
   remaining--; updateStats();
   drawGraph();
   spawn();
 };
}

function burst(x,y){
 for(let i=0;i<10;i++){
   const p=document.createElement("div");
   p.className="burst";
   p.style.width=p.style.height="6px";
   p.style.left=x+"px";
   p.style.top=y+"px";
   const angle=Math.random()*2*Math.PI;
   const dist=20+Math.random()*20;
   const dx=Math.cos(angle)*dist;
   const dy=Math.sin(angle)*dist;
   playArea.appendChild(p);
   p.animate([{transform:`translate(0,0) scale(1)`,opacity:1},
              {transform:`translate(${dx}px,${dy}px) scale(0)`,opacity:0}],{duration:500,easing:'ease-out'});
   setTimeout(()=>p.remove(),500);
 }
}

function updateStats(){
 document.getElementById("levelTxt").textContent="Level: "+levelName;
 document.getElementById("leftTxt").textContent="Targets Left: "+remaining;
 if(reflex.length){
  const last=reflex.at(-1);
  const avg=reflex.reduce((a,b)=>a+b,0)/reflex.length;
  const best=Math.min(...reflex);
  document.getElementById("lastTxt").textContent=`Last: ${last.toFixed(1)} ms`;
  document.getElementById("avgTxt").textContent=`Avg: ${avg.toFixed(1)} ms`;
  document.getElementById("bestTxt").textContent=`Best: ${best.toFixed(1)} ms`;
  document.getElementById("tierTxt").textContent="Reflex: "+reflexType(avg);
 }
}

function drawGraph(){
 ctx.clearRect(0,0,graph.width,graph.height);
 if(reflex.length<1) return;
 const pad=40;
 const n=reflex.length;
 const max=Math.max(...reflex)*1.1;
 ctx.strokeStyle='rgba(255,255,255,0.1)';
 ctx.lineWidth=1;
 const hLines=10; const vLines=Math.max(n,5);
 for(let i=0;i<=hLines;i++){
     const y = pad + i*(graph.height-pad*2)/hLines;
     ctx.beginPath();
     ctx.moveTo(pad, y); ctx.lineTo(graph.width-pad, y); ctx.stroke();
     const val = Math.round(max*(1-i/hLines));
     ctx.fillStyle="#fff"; ctx.font="10px Arial"; ctx.textAlign="right";
     ctx.fillText(val+" ms", pad-5, y+3);
 }
 for(let i=0;i<=vLines;i++){
     const x = pad + i*(graph.width-pad*2)/vLines;
     ctx.beginPath(); ctx.moveTo(x,pad); ctx.lineTo(x,graph.height-pad); ctx.stroke();
 }
 ctx.beginPath();
 reflex.forEach((v,i)=>{
     const x = pad + i*(graph.width-pad*2)/(n-1);
     const y = graph.height-pad-(v/max)*(graph.height-pad*2);
     if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
 });
 ctx.strokeStyle="#00f2fe"; ctx.lineWidth=2; ctx.stroke();
 reflex.forEach((v,i)=>{
     const x = pad + i*(graph.width-pad*2)/(n-1);
     const y = graph.height-pad-(v/max)*(graph.height-pad*2);
     ctx.fillStyle="#ff6b6b";
     ctx.beginPath(); ctx.arc(x,y,5,0,Math.PI*2); ctx.fill();
 });
}

graph.addEventListener('click',(e)=>{
 const rect=graph.getBoundingClientRect();
 const xClick=e.clientX-rect.left; const yClick=e.clientY-rect.top;
 const pad=40; const n=reflex.length; const max=Math.max(...reflex)*1.1;
 reflex.forEach((v,i)=>{
     const x = pad + i*(graph.width-pad*2)/(n-1);
     const y = graph.height-pad-(v/max)*(graph.height-pad*2);
     if(Math.hypot(x-xClick,y-yClick)<=6){
         alert(`Reflex for hit ${i+1}: ${v.toFixed(1)} ms`);
     }
 });
});

function saveBestReflex(){if(!reflex.length) return; const avg=reflex.reduce((a,b)=>a+b,0)/reflex.length; const best=localStorage.getItem("best_"+levelName); if(!best || avg<best) localStorage.setItem("best_"+levelName, avg.toFixed(1)); updateLevelInfo();}

const startBtn=document.getElementById("start-btn");
startBtn.onclick = () => {
 document.getElementById("menu").classList.add("hidden");
 document.getElementById("game").classList.remove("hidden");
 beginBtn.style.display="block";
 playArea.innerHTML=""; reflex=[]; remaining=levels[levelName].targets; ctx.clearRect(0,0,graph.width,graph.height);
};
beginBtn.onclick = () => {
 beginBtn.style.display="none";
 spawn();
};
function restart(){
 if(activeTimeout) clearTimeout(activeTimeout);
 playArea.innerHTML="";
 remaining=levels[levelName].targets;
 reflex=[];
 ctx.clearRect(0,0,graph.width,graph.height);
 beginBtn.style.display="block";
}
function quit(){
 if(activeTimeout) clearTimeout(activeTimeout);
 document.getElementById("game").classList.add("hidden");
 document.getElementById("menu").classList.remove("hidden");
 updateLevelInfo();
}
</script>
</body>
</html>
